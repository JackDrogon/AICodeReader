# æ›´æ–°æ—¥å¿—

## 2025å¹´ - golangci-lint v2.1.6 å‡çº§

### âœ¨ ä¸»è¦æ›´æ–°

1. **å‡çº§åˆ°golangci-lint v2.1.6**
   - ä»æ—§ç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°çš„v2.1.6ç‰ˆæœ¬
   - å…¼å®¹Go 1.24.x

2. **é…ç½®æ–‡ä»¶è¿ç§»**
   - ä½¿ç”¨`golangci-lint migrate`å‘½ä»¤è‡ªåŠ¨è¿ç§»é…ç½®åˆ°v2æ ¼å¼
   - æ–°çš„é…ç½®ç»“æ„æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤

3. **æ–°å¢æ ¼å¼åŒ–åŠŸèƒ½**
   - æ”¯æŒ`golangci-lint fmt`å‘½ä»¤è¿›è¡Œä»£ç æ ¼å¼åŒ–
   - é…ç½®äº†`gofmt`å’Œ`goimports`æ ¼å¼åŒ–å™¨

### ğŸ”§ é…ç½®æ”¹è¿›

#### Lintersé…ç½®
- **å¯ç”¨çš„linters**: 40ä¸ªé«˜è´¨é‡linters
- **é…ç½®ç»“æ„**: ä½¿ç”¨æ–°çš„v2æ ¼å¼ï¼ŒåŒ…å«`linters.settings`å’Œ`formatters.settings`
- **æ’é™¤è§„åˆ™**: é’ˆå¯¹æµ‹è¯•æ–‡ä»¶å’Œä¸»ç¨‹åºç›®å½•çš„çµæ´»æ’é™¤è§„åˆ™

#### å¤æ‚åº¦æ§åˆ¶
- **cyclomatic complexity**: æœ€å¤§20
- **cognitive complexity**: æœ€å¤§40
- **function length**: æœ€å¤§100è¡Œï¼Œ50è¯­å¥
- **nested if complexity**: æœ€å¤§15

#### æ–°å¢Linters
- `copyloopvar`: Go 1.22+å¾ªç¯å˜é‡æ£€æŸ¥
- `intrange`: æ•´æ•°èŒƒå›´å¾ªç¯æ£€æŸ¥
- `mirror`: é•œåƒæ¨¡å¼æ£€æŸ¥
- `sloglint`: slogä½¿ç”¨æ£€æŸ¥
- `errorlint`: é”™è¯¯å¤„ç†æ£€æŸ¥
- `errname`: é”™è¯¯å‘½åçº¦å®š

### ğŸ“ æ–°å¢æ–‡ä»¶

1. **scripts/check-dev-env.sh**
   - å¼€å‘ç¯å¢ƒæ£€æŸ¥è„šæœ¬
   - éªŒè¯Goã€golangci-lintç­‰å·¥å…·å®‰è£…
   - å½©è‰²è¾“å‡ºå’Œè¯¦ç»†æŒ‡å¯¼

2. **cmd/aicodereader/main_test.go**
   - åŸºç¡€å•å…ƒæµ‹è¯•
   - æµ‹è¯•é…ç½®åŠ è½½åŠŸèƒ½
   - è¦†ç›–ç‡æŠ¥å‘Šæ”¯æŒ

3. **CI.md**
   - è¯¦ç»†çš„CIä½¿ç”¨æŒ‡å—
   - golangci-lint v2æ–°åŠŸèƒ½è¯´æ˜
   - æœ¬åœ°å¼€å‘æœ€ä½³å®è·µ

### ğŸš€ CI/CDæ”¹è¿›

#### GitHub Actions
- å‡çº§åˆ°golangci-lint v2.1.6
- ç§»é™¤ä¸å…¼å®¹çš„timeoutå‚æ•°
- ä¼˜åŒ–ç¼“å­˜ç­–ç•¥

#### Makefileå¢å¼º
- `make ci`: å®Œæ•´CIæ£€æŸ¥
- `make check-env`: ç¯å¢ƒæ£€æŸ¥
- `make test-coverage`: è¦†ç›–ç‡æŠ¥å‘Š
- `make check-fmt`: æ ¼å¼æ£€æŸ¥

### ğŸ¯ ä½¿ç”¨æ–¹å¼

```bash
# æ£€æŸ¥å¼€å‘ç¯å¢ƒ
make check-env

# è¿è¡Œæ‰€æœ‰CIæ£€æŸ¥
make ci

# ä½¿ç”¨æ–°çš„æ ¼å¼åŒ–åŠŸèƒ½
golangci-lint fmt

# è¿ç§»æ—§é…ç½®æ–‡ä»¶(å¦‚æœéœ€è¦)
golangci-lint migrate
```

### ğŸ“ˆ æ•ˆæœ

- **ä»£ç è´¨é‡**: æ›´ä¸¥æ ¼çš„ä»£ç è´¨é‡æ£€æŸ¥
- **å¼€å‘ä½“éªŒ**: æ›´å¥½çš„æœ¬åœ°å¼€å‘å·¥å…·æ”¯æŒ
- **CIæ€§èƒ½**: ä¼˜åŒ–çš„ç¼“å­˜å’Œå¹¶è¡Œæ‰§è¡Œ
- **ç»´æŠ¤æ€§**: æ›´æ¸…æ™°çš„é…ç½®ç»“æ„å’Œæ–‡æ¡£

### ğŸ”„ å‘åå…¼å®¹

- ä¿æŒäº†åŸæœ‰çš„Makefileç›®æ ‡å…¼å®¹æ€§
- è‡ªåŠ¨è¿ç§»æ—§é…ç½®æ ¼å¼
- æ¸è¿›å¼é‡‡ç”¨æ–°åŠŸèƒ½

### ğŸ“š å‚è€ƒèµ„æ–™

- [golangci-lint v2è¿ç§»æŒ‡å—](https://golangci-lint.run/product/migration-guide/)
- [golangci-lint v2æ–°åŠŸèƒ½](https://ldez.github.io/blog/2025/03/23/golangci-lint-v2/)
- [é…ç½®å‚è€ƒ](https://golangci-lint.run/usage/configuration/)
